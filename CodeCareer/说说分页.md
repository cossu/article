# 说说分页

之前写过一篇[使用EasyUI框架如何分页](https://gazzi.farbox.com/post/programming/2015-04-05)的日志，半年过去回头再读的时候发现那时候无论是对于**分页**还是**编程**，我的理解都太过于浅显和粗陋，以至于那篇日志看起来颠三倒四，抓不住重点，让人十分不爽。所以决定重新再写一篇关于**分页**的日志，作为总结。

## 为什么要分页

在进行信息展示的时候，我们会根据业务的需要从数据库的各张表中把相应的数据取出来，再把这些数据按照我们想要的方式组合后放在浏览器/屏幕上。通常有由于历史数据量过大，出于程序的**加载速度**以及**用户的浏览体验**考虑我们不可能一口气把所有数据都加载出来，这个时候就要用到分页了。分页的具体形式多中多样，比如在浏览微博的时候我们就遇到了两种最常见的形式：

1. 下拉刷新
2. 点击翻页

在每次激活翻页操作的时候，系统就会多加载一部分数据并将其展示到浏览器/屏幕上，这样即能够让用户和系统有一个良好的交互又能够让用户保持一个良好的阅读节奏。

## 怎么分页

上文谈及数据是从*数据库中取出*再传递到浏览器/屏幕上的，所以分页的核心操作自然是在于数据库查询这一块了。在日常的工作中我接触过SQLSEVER和MYSQL两种数据库，现在就这两种数据库怎么实现分页来对分页的原理做一下介绍和记录，相信在理解了原理以后即使碰到没用过的数据库类型也能够快速的找到解决方案。

### 一，接收参数

在进行数据库查询之前，我们需要从前台页面接受到两个参数：

1. 页码（以下我们皆用page代替，从1开始计数）
2. 每页容量（以下我们皆用pagesize代替，例：*当pagesize为10，则每页显示10条数据*）

### 二，查询

#### （SQLSEVER）利用关键字——Not IN和字句——Top

示例如下：

```
select top（rows） * from MyTable as A 
where  1=1 and  A.ID NOT IN（select TOP（（page-1）*rows）A.ID from MyTable as A where 1=1）
```

下面对这个SQL语句进行一下简要分析。这块代码由三部分组成。

1. 查询项：`top（rows） *` ：选取结果集的前rows条数据

2. 查询表：这里并没有进行联表操作 ,如果有业务需要可以自行添加

3. 查询条件：

   ```
   1=1
   ```

    和

   ```
   A.ID NOT IN(select  ……
   ```

   这里的

   ```
   1=1
   ```

   可以根据实际需要自行扩展。

   分页的关键

   就在

   ```
   A.ID NOT IN(select  ……
   ```

   一句。这一句的意思为，返回的结果集为排除掉

   ```
   （select……）
   ```

   后的余集，排除的条件是

   ```
   A.ID
   ```

   是否在

   ```
   (select……)
   ```

   中。 这里有两点需要说明，

   -  ***在进行`(select …… )`查询的时候，这个结果集只能返回一列，那就是`A.ID`，否则sql会报错。\***
   -  `(select ……)`的查询条件应与主句的查询条件一致。

#### （SQLSEVER）利用Row_number

上面所介绍的Not In方法虽然理解起来较为简单但是由于需要反复查表，导致代码效率低下，下面我们记录了另一种分页方式——Row__number。
它的基本原理是为SQL表格创建一列序号，我们在查询的时候可以通过对这个序号列进行约束来实现分页效果。示例代码如下：

```
select * from (
select ROW_NUMBER()over( order by id1) orderid,* from A
) a where a.orderid between (page-1)*pagesize and page*pagesize
```

#### （MYSQL）利用LIMIT进行分页

就分页而言，MYSQL比sqlsever要方便的多。只需要利用LIMIT关键字即可，代码如下：

```
select * from A Limit (page-1)*pagesize,pagesize
```

对于数据库查询这一环节还有许多实现方法，每个框架也都各自封装有相应的操作函数，使用起来极其方便。

### 前台参数

对于前台来讲，需要着重考虑的点在于如何维护好**当前页**和**总页数**这两个参数。

## 总结

以上便是我对于***分页\***的理解以及分页方法的记录。相信随着**工作经验**的积累和**编程知识**的掌握，我会对***分页\***有更加立体的理解。到时再来记录和总结与然后这篇进行对比，不失为一种好的学习方法。

2015-10-19